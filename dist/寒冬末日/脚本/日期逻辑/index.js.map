{"version":3,"file":"index.js","mappings":"AACA,IAAIA,EAAsB,CCA1BA,EAAyBC,IACxB,IAAIC,EAASD,GAAUA,EAAOE,WAC7B,IAAOF,EAAiB,QACxB,IAAM,EAEP,OADAD,EAAoBI,EAAEF,EAAQ,CAAEG,IACzBH,GCLRF,EAAwB,CAACM,EAASC,KACjC,IAAI,IAAIC,KAAOD,EACXP,EAAoBS,EAAEF,EAAYC,KAASR,EAAoBS,EAAEH,EAASE,IAC5EE,OAAOC,eAAeL,EAASE,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,MCJ3ER,EAAwB,CAACc,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,ICAlF,MAAM,EAA+BI,E,aCGrC,SAASC,EAAmBC,GAC1B,IAAKA,EAAS,OAAO,EACrB,MAAMC,EAAQD,EAAQC,MAAM,mBAC5B,OAAIA,EAC0B,GAArBC,SAASD,EAAM,IAAWC,SAASD,EAAM,IAE3C,CACT,CAoBAE,EAAEC,gBAEMC,sBAAsB,OAI5BC,QAAQC,IAAIC,OAAOC,sBAAuB,CAACC,EAAeC,KAExD,MAAMC,EAAa,QAAMD,EAAe,kBAAmB,IACrDE,EAAa,QAAMH,EAAe,kBAAmB,IAG3D,GAAIE,IAAeC,EAAY,OAO/B,GALmBd,EAAmBa,GACnBb,EAAmBc,GAIT,CAC3BC,QAAQC,IAAI,2CAEZ,MAAMC,EAAa,QAAML,EAAe,kBAAmB,IAI3D,GAAIK,IAHe,QAAMN,EAAe,kBAAmB,IAG5B,CAC7BI,QAAQC,IAAI,4DAEZ,MAAME,EA9Cd,SAAmBC,GACjB,IAAKA,EAAS,OAAO,IAAIC,KACzB,MAAMlB,EAAQiB,EAAQjB,MAAM,sBAC5B,GAAIA,EAAO,CACT,MAAMmB,EAAOlB,SAASD,EAAM,IACtBoB,EAAQnB,SAASD,EAAM,IAAM,EAC7BqB,EAAMpB,SAASD,EAAM,IAC3B,OAAO,IAAIkB,KAAKC,EAAMC,EAAOC,EAC/B,CACA,OAAO,IAAIH,IACb,CAoCwBI,CAAUP,GAC1BC,EAAQO,QAAQP,EAAQQ,UAAY,GAEpC,MAAMC,EAnCL,SADWC,EAoCmBV,GAnCjBW,iBAAiBD,EAAKE,WAAa,KAAKF,EAAKF,aAsC3D,QAAMf,EAAe,kBAAmBgB,GAGxC,MAAMI,EAAU,QAAMpB,EAAe,qBACd,iBAAZoB,GACT,QAAMpB,EAAe,oBAAqBoB,EAAU,EAExD,CACF,CA/CJ,IAAoBH","sources":["src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/webpack/runtime/compat get default export","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand","src://tavern_helper_template/external var \"_\"","src://tavern_helper_template/src/寒冬末日/脚本/日期逻辑/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = _;","import _ from 'lodash';\n\n// 解析时间字符串为分钟数 (格式: \"时间段 - HH:MM\")\nfunction parseTimeToMinutes(timeStr: string): number {\n  if (!timeStr) return 0;\n  const match = timeStr.match(/(\\d{2}):(\\d{2})/);\n  if (match) {\n    return parseInt(match[1]) * 60 + parseInt(match[2]);\n  }\n  return 0;\n}\n\n// 解析日期字符串 (格式: \"末日纪元，XXXX年XX月XX日\")\nfunction parseDate(dateStr: string): Date {\n  if (!dateStr) return new Date();\n  const match = dateStr.match(/(\\d+)年(\\d+)月(\\d+)日/);\n  if (match) {\n    const year = parseInt(match[1]);\n    const month = parseInt(match[2]) - 1; // JS month is 0-indexed\n    const day = parseInt(match[3]);\n    return new Date(year, month, day);\n  }\n  return new Date();\n}\n\n// 格式化日期\nfunction formatDate(date: Date): string {\n  return `末日纪元，${date.getFullYear()}年${date.getMonth() + 1}月${date.getDate()}日`;\n}\n\n$(async () => {\n  // @ts-ignore\n  await waitGlobalInitialized('Mvu');\n\n  // 监听变量更新结束事件\n  // @ts-ignore\n  eventOn(Mvu.events.VARIABLE_UPDATE_ENDED, (new_variables, old_variables) => {\n    // 1. 获取新旧时间\n    const oldTimeStr = _.get(old_variables, 'stat_data.世界.时间', '');\n    const newTimeStr = _.get(new_variables, 'stat_data.世界.时间', '');\n\n    // 如果时间没变，不做处理\n    if (oldTimeStr === newTimeStr) return;\n\n    const oldMinutes = parseTimeToMinutes(oldTimeStr);\n    const newMinutes = parseTimeToMinutes(newTimeStr);\n\n    // 2. 检测是否跨越午夜 (旧时间 > 新时间，例如 23:00 -> 01:00)\n    // 注意：如果时间流逝极长(超过24小时)这逻辑可能失效，但通常不会\n    if (oldMinutes > newMinutes) {\n      console.log('[DateLogic] Detected midnight crossing.');\n\n      const oldDateStr = _.get(old_variables, 'stat_data.世界.日期', '');\n      const newDateStr = _.get(new_variables, 'stat_data.世界.日期', '');\n\n      // 3. 如果 AI 没有更新日期，则手动更新\n      if (oldDateStr === newDateStr) {\n        console.log('[DateLogic] AI did not update date, updating manually...');\n\n        const dateObj = parseDate(oldDateStr);\n        dateObj.setDate(dateObj.getDate() + 1); // 加一天\n\n        const nextDateStr = formatDate(dateObj);\n\n        // 更新日期\n        _.set(new_variables, 'stat_data.世界.日期', nextDateStr);\n\n        // 同时更新末日天数\n        const oldDays = _.get(new_variables, 'stat_data.世界.末日天数');\n        if (typeof oldDays === 'number') {\n          _.set(new_variables, 'stat_data.世界.末日天数', oldDays + 1);\n        }\n      }\n    }\n  });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","_","parseTimeToMinutes","timeStr","match","parseInt","$","async","waitGlobalInitialized","eventOn","Mvu","events","VARIABLE_UPDATE_ENDED","new_variables","old_variables","oldTimeStr","newTimeStr","console","log","oldDateStr","dateObj","dateStr","Date","year","month","day","parseDate","setDate","getDate","nextDateStr","date","getFullYear","getMonth","oldDays"],"ignoreList":[],"sourceRoot":""}