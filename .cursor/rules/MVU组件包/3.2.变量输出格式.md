# 模块3.2:变量输出格式生成指令

## 模块定义

本模块负责生成变量更新时的输出格式指令。该指令集用于指导 AI 系统如何分析并请求更新当前上下文中的动态变量。

**更新命令格式**:使用 **JSON Patch (RFC 6902)** 标准

**前置依赖**:
- 模块2(变量更新规则)- 提供更新逻辑

---

## 生成任务

直接输出标准的变量输出格式模板,无需替换具体作品的变量内容。

**操作步骤**:
1. 将下方"输出格式模板"部分的内容原样输出
2. 保持模板中的占位符和格式不变

---

## 输出格式模板

```yaml
---
变量输出格式:
  rule:
    - you should output the update analysis and the actual update commands in the end of the next reply
    - the update commands must strictly follow the **JSON Patch (RFC 6902)** standard, but can only use the following operations: `replace` (replace the value of existing paths), `add` (only used to insert new items into an object or array), `remove`; that is, the output must be a valid JSON array containing operation objects
  format: |-
    <UpdateVariable>
    <Analysis>$(IN ENGLISH, no more than 80 words)
    - ${calculate time passed: ...}
    - ${decide whether dramatic updates are allowed as it's in a special case or the time passed is more than usual: yes/no}
    - ${analyze every variable based on its corresponding `check`, according only to current reply instead of previous plots: ...}
    </Analysis>
    <JSONPatch>
    [
      { "op": "replace", "path": "${/path/to/variable}", "value": "${new_value}" },
      { "op": "add", "path": "${/path/to/object/newKey}", "value": "${content}" }
      { "op": "remove", "path": "${/path/to/array/0}" },
      ...
    ]
    </JSONPatch>
    </UpdateVariable>
```

---

## 输出要求

将上方"输出格式模板"部分的内容原样复制到文件中,保持所有占位符和格式不变。

---

## 生成指令

生成内容后,使用 Write 工具将内容保存到 `[mvu_update]变量输出格式.yaml` 文件中。

---

## 重要提醒

- **原样输出**:保持模板内容不变,包括所有占位符和示例
- **JSON Patch 标准**:输出的指令集遵循 RFC 6902 规范
- **路径格式**:使用 `/` 分隔,数组末尾用 `-`
- **通用性**:此为通用模板,适用于所有 MVU Zod 项目
