import _ from 'lodash';
import { z } from 'zod';

// ---------------------
// 1. 定义独立的部分 Schema
// ---------------------

// 初始店铺数据
export const INITIAL_SHOP_LIST = [
  {
    shopname: '【都市猎艳】擦肩而过的悸动',
    shop_id: 20241222001,
    shoptags: ['通勤日常', '制服诱惑', '公共场所'],
    packages: [
      {
        name: '晚高峰的地铁OL·拥挤中的摩擦',
        price: 588,
        stars: 4.7,
        icon: 'fas fa-subway',
        tags: ['车厢痴汉', '职场正装', '强制接触'],
        image1:
          '###26岁、面容疲惫的中国职场女性，身着黑色修身西装套裙，站在拥挤的地铁车厢内，右手抓着高处扶手，腋下曲线展露。纪实摄影风格，Leica M10拍摄，35mm镜头。车厢内冷白顶光，面部明暗交界清晰，眼神放空。4K分辨率，皮肤毛孔可见，汗水微光。###',
        image2:
          '###女性腰部以下特写，黑色包臀裙被后方乘客挤压出明显的臀部轮廓，肉色丝袜包裹的大腿肌肉紧绷。微距摄影，浅景深。环境光昏暗，裙褶纹理清晰，丝袜光泽细腻。8K分辨率，材质质感真实。###',
        image3:
          '###俯视视角，女性白色衬衫领口第二颗纽扣崩开，露出黑色蕾丝内衣边缘及上胸部皮肤，汗珠沿锁骨滑落。特写镜头。局部高光照明，汗水反光强烈，皮肤白皙细腻。8K分辨率，无畸变，细节锐利。###',
        description:
          '那时候是周五的晚高峰，你在拥挤的地铁三号线上被挤得动弹不得。紧贴着你的是一位典型的都市OL，她身上的廉价香水味混合着忙碌一天的淡淡汗味钻进你的鼻孔。随着列车的晃动，她那穿包臀裙的丰满屁股一次次撞击你的胯下，你能感觉到她大腿肉在丝袜包裹下的温热和弹性。看着她为了保持平衡而高举手臂露出的衬衫崩开的缝隙，你那被生活压抑的欲望瞬间抬头。真想在这拥挤的人潮中，悄悄掀起她的裙子，在那无数人见证却无人察觉的角落，把肉棒狠狠顶进她湿热的小穴，让她只能咬着嘴唇不敢出声。',
        content: ['在此刻拥挤的车厢内直接顶进去', '跟随她下车在站台卫生间快搞', '要把精液射在她的丝袜和高跟鞋上'],
        reviews: [
          '别...别在这里...会被发现的...求你...轻点...',
          '来自路人视角："现在的年轻人真是大胆，地铁上都贴那么紧。"',
        ],
      },
      {
        name: '写字楼的保洁阿姨·楼梯间的回响',
        price: 388,
        stars: 4.5,
        icon: 'fas fa-broom',
        tags: ['成熟韵味', '身份反差', '快速解决'],
        image1:
          '###42岁、身材丰腴的中国中年女性，身着灰色保洁制服，头发用发网盘起，正在擦拭楼梯扶手，面部表情专注。现实主义风格，Canon 5D Mark IV拍摄，50mm镜头。楼梯间感应灯光，侧光勾勒面部轮廓，氛围静谧。6K分辨率，面部细纹真实，妆容素淡。###',
        image2:
          '###女性弯腰擦拭地面的背影，宽松制服裤紧贴臀部，勒出宽大肥硕的臀型和内裤勒痕。中景镜头。顶部垂直光照，衣物褶皱阴影深重，体态敦实丰满。8K分辨率，布料质感粗糙，真实感强。###',
        image3:
          '###女性坐在楼梯台阶上休息，制服领口敞开，露出洗得发白的肉色大码文胸和深邃乳沟，胸部皮肤有汗渍。特写镜头。暗光环境，局部补光照亮胸部，皮肤松弛度符合年龄。8K分辨率，汗水细节清晰。###',
        description:
          '你在加班到深夜的写字楼里抽烟，透过防火门的玻璃，看到那个平时默默无闻的保洁阿姨正在拖地。她弯腰时，那肥硕的屁股把制服裤撑得满满当当，随着动作左右摇摆，透着一股成熟妇人特有的肉欲。她直起身擦汗，那并不精致但充满母性气息的脸庞让你想起了邻居家经常照顾你的阿姨。在这空无一人的深夜大楼里，这种原始的肉欲冲破了理智。你只想把她按在充满消毒水味道的楼梯间墙上，扒下那条廉价的裤子，在声控灯的忽明忽灭中，享用这具熟透了的、肥美多汁的身体。',
        content: ['在楼梯间按着头后入', '让她趴在拖把池边服务', '射在她的保洁制服上'],
        reviews: [
          '小伙子...这不行...阿姨年纪都这么大了...脏...',
          '来自保安："最近楼梯间怎么总有股怪味，得让保洁多拖几遍。"',
        ],
      },
      {
        name: '星巴克的相亲女·被放鸽子的安慰',
        price: 688,
        stars: 4.8,
        icon: 'fas fa-coffee',
        tags: ['精心打扮', '情感趁虚', '高档场所'],
        image1:
          '###24岁、妆容精致的中国年轻女性，身着白色露肩连衣裙，独自坐在咖啡厅窗边，不停看手机，神情焦虑失落。都市人像摄影，Sony A7R IV拍摄，85mm f/1.4镜头。午后自然光透过落地窗，面部光影柔和，背景虚化唯美。8K分辨率，发丝光泽清晰，妆面无瑕。###',
        image2:
          '###女性双腿交叠坐在高脚椅上，连衣裙开叉处露出白皙大腿，脚上是一双精致的银色细高跟凉鞋，脚踝纤细。低角度拍摄。室内暖色氛围灯，腿部线条流畅，肤色均匀。8K分辨率，肌肉线条自然。###',
        image3:
          '###女性低头搅动咖啡，视角聚焦于连衣裙领口，深V设计展露饱满胸型，锁骨窝深陷，皮肤白嫩。特写镜头。柔和散射光，胸部阴影自然，项链反光清晰。8K分辨率，皮肤质感通透。###',
        description:
          '周六下午的星巴克，你注意到邻桌那个精心打扮的女孩已经等了一个小时。她穿着显身材的小礼服，化了全妆，显然是为了见重要的人，但电话那头传来的似乎是推脱之词。看着她从期待转为失落，眼眶微红地咬着吸管，那副楚楚可怜又带着点被羞辱后的愤懑模样，让你想起了那种扭曲的破坏欲。那些精心准备的妆容和衣着不该被浪费。你现在的冲动就是走过去，不用废话，直接在这个充满小资情调的咖啡馆厕所里，撕碎她的矜持，让她在你的胯下哭着发泄被抛弃的委屈。',
        content: ['假装是相亲对象直接带走', '在咖啡馆残疾人卫生间速战', '让她含着满嘴精液补妆'],
        reviews: [
          '既然他不要我了...那你来爱我好不好...哪怕只是身体...',
          '来自服务员："那桌客人好像哭了，要去送纸巾吗？"',
        ],
      },
    ],
  },
  {
    shopname: '【市井芳香】生活转角的惊喜',
    shop_id: 20241222002,
    shoptags: ['邻家日常', '生活气息', '绝对隐私'],
    packages: [
      {
        name: '深夜便利店的兼职学妹·收银台下的秘密',
        price: 499,
        stars: 4.8,
        icon: 'fas fa-shopping-basket',
        tags: ['青春活力', '制服短裙', '监控盲区'],
        image1:
          '###19岁、扎马尾辫的中国少女，身着红绿配色便利店制服，趴在收银台上打瞌睡，脸上充满胶原蛋白。日系生活摄影，Fujifilm X-T4拍摄，35mm镜头。店内高亮日光灯，面部光线平整，色彩鲜艳。4K分辨率，面部绒毛可见，神态自然。###',
        image2:
          '###少女站在货架前整理商品，短裙下露出一双穿着白色短袜的光洁小腿，膝盖粉嫩，大腿内侧线条紧致。全身镜头。冷白光源，腿部皮肤反光自然，无异常阴影。8K分辨率，腿部比例写实。###',
        image3:
          '###收银台内侧视角，少女坐在低矮板凳上玩手机，双腿大大张开，裙底白色棉质内裤和骆驼趾轮廓清晰可见。偷拍视角。光线昏暗，局部噪点真实，私密部位细节明确。8K分辨率，布料纹理清晰。###',
        description:
          '凌晨两点去楼下便利店买烟，店里只有那个兼职的大学生妹子。她正戴着耳机哼歌，完全没注意到你进门。制服裙短得离谱，当你假装挑关东煮时，看到她为了拿高处的纸巾踮起脚尖，裙摆上移露出了可爱的草莓胖次。这种毫无防备的青春肉体在深夜显得格外诱人。这会儿店里也没别人，监控死角你早就摸清了。你现在的脑子里只有一个念头：把"暂停营业"的牌子挂出去，把这个不知世间险恶的小学妹抱上收银台，就在那一堆口香糖和避孕孕套旁边，狠狠教她做大人的道理。',
        content: ['在收银台把腿架在肩膀上干', '让她一边结账一边被手指玩弄', '射在热气腾腾的关东煮锅里'],
        reviews: ['大叔...好痛...轻点...要是有人进来怎么办...', '来自店长："最近夜班盘点怎么总少东西？下次查查监控。"'],
      },
      {
        name: '取快递的邻家少妇·真空的睡衣',
        price: 666,
        stars: 4.6,
        icon: 'fas fa-box-open',
        tags: ['人妻背德', '居家私密', '真空上阵'],
        image1:
          '###28岁、素颜的中国少妇，身着淡粉色丝绸吊带睡裙，站在公寓楼道取件箱前，头发随意挽起。日常抓拍风格，iPhone 13 Pro拍摄。楼道声控暖光，面部光影立体，眼神慵懒。4K分辨率，皮肤质感真实，无美颜磨皮。###',
        image2:
          '###侧面视角，睡裙面料轻薄贴身，胸部两点突起明显，侧乳轮廓若隐若现，腰肢纤细。中景镜头。顶部光源，丝绸反光强烈，身体曲线毕露。8K分辨率，乳头凸起细节清晰。###',
        image3:
          '###少妇弯腰从低处柜门取快递，领口大开，那对硕大的乳房像水球一样垂下，深邃乳沟和乳晕边缘清晰可见。高机位俯拍。局部照明，胸部皮肤白皙，血管隐约可见。8K分辨率，重力下垂感真实。###',
        description:
          '你去小区丰巢柜取快递，正好碰见住你楼下的新婚少妇也在取件。她似乎觉得只是下楼一趟无所谓，只穿了一件薄得透光的真丝睡裙，里面明显是真空的。当她踮起脚够上层的柜门时，睡裙紧贴着身体，勾勒出那两粒硬挺的乳头和圆润的屁股蛋。那一瞬间，邻里之间的礼貌防线在你脑中崩塌。看着她毫无防备的背影，你想直接从后面捂住她的嘴，把她推进旁边的消防通道，撕开那层薄薄的阻碍，在这个随时可能有人经过的公用空间里，狠狠侵犯这个不守妇道的女人。',
        content: ['在消防通道强行后入', '把她拖进自家玄关就开始做', '用快递盒垫着她的屁股干'],
        reviews: ['别...那是邻居...会被听到的...啊...不行...', '来自你妈："楼下小媳妇挺热情的，下次见面打招呼。"'],
      },
      {
        name: '公园晨跑的瑜伽教练·汗湿的紧身裤',
        price: 555,
        stars: 4.9,
        icon: 'fas fa-running',
        tags: ['健康肉体', '紧身包裹', '野外露出'],
        image1:
          '###30岁、皮肤小麦色的中国运动女性，身着荧光色运动内衣和瑜伽裤，在公园长椅上压腿，汗水流淌。运动摄影风格，Nikon D850拍摄，70-200mm镜头。晨光逆光拍摄，发丝金黄，面部轮廓硬朗。8K分辨率，汗珠晶莹，肌肉线条清晰。###',
        image2:
          '###女性背部视角，紧身瑜伽裤将臀部包裹得浑圆挺翘，因为汗湿，布料嵌入臀缝，呈现清晰的"W"形。特写镜头。侧顺光，臀部立体感强，布料紧绷。8K分辨率，无异常拉伸，真实感极强。###',
        image3:
          '###女性做开合跳动作，胸部剧烈晃动，运动内衣勒出深陷的乳沟，腋下和胸口处有明显深色汗渍。抓拍镜头。高速快门凝固动作，光影对比强烈，荷尔蒙气息浓郁。8K分辨率，动态模糊极少，细节锐利。###',
        description:
          '你在公园晨跑时，总能遇到这个身材火辣的瑜伽教练。她穿着最紧身的运动装，做着各种高难度的拉伸动作，那被瑜伽裤勒出的骆驼趾和因为出汗而紧贴在身上的布料，简直就是行走的春药。今天她似乎跑累了，躲在小树林深处的长椅上休息，胸口剧烈起伏，大口喘着粗气。看着她那红扑扑的脸蛋和全是汗水的亮晶晶的大腿，你心里的野兽彻底觉醒。这里没人会来，你只想冲过去，利用她身体极佳的柔韧性，把她的双腿折叠到头上，在这充满草木清香的野外，品尝这具充满弹性和力量的肉体。',
        content: ['在公园长椅上高难度体位', '按在树干上站立后入', '射在她满是汗水的马甲线上'],
        reviews: [
          '呼...呼...教练没教过这个动作...太深了...',
          '来自公园大爷："现在的年轻人身体真好，大清早就练这么猛。"',
        ],
      },
    ],
  },
];

// 店铺单项 Schema (从原 Schema 中提取，保留供内部使用)
export const ShopItemSchema = z
  .object({
    shopname: z.string(),
    shop_id: z.coerce.number(),
    shoptags: z.array(z.string()),
    packages: z
      .array(
        z
          .object({
            name: z.string(),
            price: z.coerce.number(),
            stars: z.coerce.number(),
            icon: z.string(),
            tags: z.array(z.string()),
            image1: z.string(),
            image2: z.string(),
            image3: z.string(),
            description: z.string(),
            content: z.array(z.string()),
            reviews: z.array(z.string()),
          })
          .strict(),
      )
      .describe('套餐列表'),
  })
  .strict();

// ---------------------
// 2. 主 Schema (Message Scope / stat_data)
// ---------------------
export const Schema = z.object({
  经济: z
    .object({
      账户余额: z.coerce.number(),
      订单消费: z.coerce.number(),
    })
    .strict(),
  订单模板: z
    .object({
      新订单原型: z
        .object({
          id: z.string(),
          订单状态: z.enum(['服务中', '服务结束']),
          基础信息: z
            .object({
              姓名: z.string(),
              年龄: z.coerce.number(),
              身份: z.string(),
              描述: z.string(),
            })
            .strict(),
          服装: z.record(z.string(), z.string()),
          套餐: z
            .object({
              套餐名称: z.string(),
              套餐价格: z.coerce.number(),
              折后价格: z.coerce.number(),
              玩法特色: z.array(z.string()),
              商品类型: z.string(),
            })
            .strict(),
          心理状态: z
            .object({
              当前所想: z.string(),
              好感度: z.coerce.number().transform(v => _.clamp(v, 0, 100)),
              兴奋度: z.coerce.number().transform(v => _.clamp(v, 0, 100)),
              性格类型: z.string(),
            })
            .strict(),
          身体特征: z
            .object({
              三围: z.object({ 描述: z.string(), 罩杯: z.string() }).strict(),
              乳房: z.object({ 形状: z.string() }).strict(),
              姿势: z.string(),
              胸部: z.string(),
              私处: z.string(),
            })
            .strict(),
          性经验: z
            .object({
              处女: z.enum(['是', '否']),
              性伴侣数量: z.coerce.number(),
              初次性行为对象: z.string(),
              怀孕几率: z.coerce.number().transform(v => _.clamp(v, 0, 100)),
              下单次数: z.coerce.number(),
            })
            .strict(),
          服务统计: z
            .object({
              心跳: z.coerce.number().transform(v => _.clamp(v, 60, 200)),
              本次服务性交次数: z.coerce.number(),
              内射次数: z.coerce.number(),
            })
            .strict(),
        })
        .strict(),
    })
    .strict(),
  系统状态: z
    .object({
      多人服务触发: z.boolean(),
      复购记忆保留: z.boolean(),
      当前场景: z.string(),
      当前模式: z.string(),
    })
    .strict(),
  推荐标签: z.array(z.string()).default(['zod店铺集成']),
  服务中的订单: z
    .record(
      z.string().describe('订单ID'),
      z
        .object({
          id: z.string(),
          订单状态: z.enum(['服务中', '服务结束']),
          基础信息: z
            .object({
              姓名: z.string(),
              年龄: z.coerce.number(),
              身份: z.string(),
              描述: z.string(),
            })
            .strict(),
          服装: z.record(z.string(), z.string()),
          套餐: z
            .object({
              套餐名称: z.string(),
              套餐价格: z.coerce.number(),
              折后价格: z.coerce.number(),
              玩法特色: z.array(z.string()),
              商品类型: z.string(),
            })
            .strict(),
          心理状态: z
            .object({
              当前所想: z.string(),
              好感度: z.coerce.number().transform(v => _.clamp(v, 0, 100)),
              兴奋度: z.coerce.number().transform(v => _.clamp(v, 0, 100)),
              性格类型: z.string(),
            })
            .strict(),
          身体特征: z
            .object({
              三围: z.object({ 描述: z.string(), 罩杯: z.string() }).strict(),
              乳房: z.object({ 形状: z.string() }).strict(),
              姿势: z.string(),
              胸部: z.string(),
              私处: z.string(),
            })
            .strict(),
          性经验: z
            .object({
              处女: z.enum(['是', '否']),
              性伴侣数量: z.coerce.number(),
              初次性行为对象: z.string(),
              怀孕几率: z.coerce.number().transform(v => _.clamp(v, 0, 100)),
              下单次数: z.coerce.number(),
            })
            .strict(),
          服务统计: z
            .object({
              心跳: z.coerce.number().transform(v => _.clamp(v, 60, 200)),
              本次服务性交次数: z.coerce.number(),
              内射次数: z.coerce.number(),
            })
            .strict(),
        })
        .strict(),
    )
    .prefault({}),
  店铺列表: z.array(ShopItemSchema).default(INITIAL_SHOP_LIST),
});

export type Schema = z.output<typeof Schema>;
