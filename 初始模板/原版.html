```html
<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>æœ«æ—¥ä¼Šç”¸å›­</title>
    <style>
      :root {
        --bg-main: #1a1b26;
        --bg-light: #282a36;
        --bg-medium: #44475a;
        --bg-dark: #13141b;
        --border-color: #8be9fd;
        --border-shadow-color: #b3f2ff;
        --text-color: #f8f8f2;
        --text-strong: #ffffff;
        --dialog-color: #50fa7b;
        --thought-color: #ff79c6;
        --accent-gold: #f1fa8c;
        --accent-red: #ff5555;
        --accent-blue: #bd93f9;
        --health-bar-color: #50fa7b;
        --border-radius: 12px;
        --section-gap: 16px;
        --inner-padding: 18px;
        --transition-speed: 0.3s;
        --font-main:
          'Microsoft YaHei', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      }
      :root[data-theme='jade_green'] {
        --bg-main: #f0f8f8;
        --bg-light: #ffffff;
        --bg-medium: #e0f0e0;
        --bg-dark: #d0e0d0;
        --border-color: #20b2aa;
        --border-shadow-color: #a7dbd8;
        --text-color: #333333;
        --text-strong: #000000;
        --dialog-color: #1e90ff;
        --thought-color: #6a5acd;
        --accent-gold: #ffa500;
        --accent-red: #dc143c;
        --accent-blue: #4682b4;
        --health-bar-color: #28a745;
      }
      :root[data-theme='parchment'] {
        --bg-main: #efe3c3;
        --bg-light: #e8d9b0;
        --bg-medium: '#c3a56e';
        --bg-dark: #6c4a24;
        --border-color: #8a6642;
        --border-shadow-color: #5a3a28;
        --text-color: #3a2d1f;
        --text-strong: #000000;
        --dialog-color: '#1e3a8a';
        --thought-color: #8b0000;
        --accent-gold: #c19a49;
        --accent-red: #8b3a3a;
        --accent-blue: #2c4875;
        --health-bar-color: #d2691e;
      }
      :root[data-theme='milky'] {
        --bg-main: #f5f5f5;
        --bg-medium: #e8e8e8;
        --bg-light: #ffffff;
        --bg-dark: #dcdcdc;
        --border-color: #79a07b;
        --border-shadow-color: #c0c0c0;
        --text-color: #4a4a4a;
        --text-strong: #000000;
        --dialog-color: #4682b4;
        --thought-color: #6a5acd;
        --accent-gold: '#d2b48c';
        --accent-red: #cd5c5c;
        --accent-blue: #5f9ea0;
        --health-bar-color: #8fbc8f;
      }
      body {
        font-family: var(--font-main);
        margin: 0;
        padding: 8px;
        background-color: transparent;
        color: var(--text-color);
        line-height: 1.7;
        box-sizing: border-box;
      }
      * {
        box-sizing: inherit;
      }
      main {
        font-size: 16px;
        font-size: var(--font-size-main, 16px);
        border: 1px solid var(--border-color);
        box-shadow:
          0 0 25px 0px var(--border-shadow-color),
          inset 0 0 15px rgba(255, 255, 255, 0.05);
        background-color: var(--bg-main);
        padding: 20px;
        border-radius: var(--border-radius);
        max-width: 900px;
        margin: 10px auto;
        width: 100%;
        display: flex;
        flex-direction: column;
        gap: var(--section-gap);
      }
      .section {
        background-color: var(--bg-light);
        padding: var(--inner-padding);
        border-radius: var(--border-radius);
        border: 1px solid rgba(200, 200, 220, 0.1);
        position: relative;
      }
      .section-title {
        font-size: 1.25em;
        font-weight: bold;
        color: var(--text-strong);
        text-align: center;
        margin: 0 0 16px 0;
        border-bottom: 2px solid var(--border-color);
        padding-bottom: 10px;
      }
      .choices-title {
        text-align: left !important;
        border-bottom: none !important;
        padding-bottom: 0 !important;
      }
      .global-info-bar {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      .info-item {
        padding: 4px 10px;
        border-radius: 8px;
        background-color: var(--bg-medium);
        font-size: 0.9em;
        width: 100%;
        white-space: normal;
      }
      .info-item#game-location {
        color: var(--accent-blue);
      }
      .info-item#game-date {
        color: var(--accent-gold);
      }
      .info-item#game-time {
        color: var(--accent-red);
      }
      .content-text {
        white-space: pre-line;
        word-break: break-word;
      }
      .dialog-text {
        color: var(--dialog-color);
        font-weight: 500;
      }
      .thought-text {
        color: var(--thought-color);
        font-style: italic;
      }
      .shelter-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
      }
      .shelter-item .label {
        font-size: 0.9em;
        color: var(--text-color);
        opacity: 0.8;
        margin-bottom: 6px;
      }
      .shelter-item .value {
        font-size: 1.05em;
        color: var(--text-strong);
      }
      .ability-list {
        max-height: 280px;
        overflow-y: auto;
        padding: 10px;
        background-color: var(--bg-dark);
        border-radius: 8px;
      }
      .ability-card {
        background-color: var(--bg-medium);
        padding: 12px;
        border-radius: 6px;
        margin-bottom: 8px;
      }
      .ability-card .name {
        font-weight: bold;
        color: var(--border-color);
        margin-bottom: 4px;
      }
      .ability-card .desc {
        font-size: 0.85em;
        opacity: 0.8;
      }
      .status-tabs-container {
        background-color: var(--bg-dark);
        border-radius: var(--border-radius);
        overflow: hidden;
        border: 1px solid rgba(200, 200, 220, 0.1);
      }
      .tab-buttons {
        display: flex;
        flex-wrap: wrap;
        background-color: var(--bg-medium);
        padding: 5px;
      }
      .tab-button {
        padding: 8px 14px;
        cursor: pointer;
        border: none;
        background-color: transparent;
        color: var(--text-color);
        font-size: 0.9em;
        transition: var(--transition-speed);
        border-radius: 8px;
        margin: 2px;
      }
      .tab-button:hover {
        background-color: var(--bg-light);
      }
      .tab-button.active {
        background-color: var(--border-color);
        color: var(--bg-dark);
        font-weight: bold;
        box-shadow: 0 0 10px rgba(200, 150, 230, 0.5);
      }
      .tab-content {
        display: none;
        padding: var(--inner-padding);
        animation: fadeIn 0.5s;
      }
      .tab-content.active {
        display: block;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      .status-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
      }
      .status-item {
        background-color: var(--bg-light);
        padding: 10px 14px;
        border-radius: 8px;
        border-left: 3px solid var(--border-color);
        display: flex;
        flex-direction: column;
      }
      .details-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      .status-item .label {
        font-size: 0.9em;
        font-weight: bold;
        color: var(--text-color);
        opacity: 0.8;
        margin-bottom: 6px;
      }
      .status-item .value {
        font-size: 0.95em;
        word-break: break-word;
        opacity: 0.9;
      }
      .health-section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 6px;
      }
      .health-status-subtext {
        font-size: 0.8em;
        opacity: 0.9;
        color: var(--accent-gold);
        font-weight: bold;
        margin-bottom: 4px;
      }
      .value-subtext {
        font-size: 0.8em;
        opacity: 0.7;
        font-style: italic;
        margin-top: 4px;
      }
      .progress-bar-container {
        width: 100%;
        height: 8px;
        background-color: var(--bg-dark);
        border-radius: 4px;
        overflow: hidden;
        margin-top: 4px;
      }
      .progress-bar-value {
        height: 100%;
        background-color: var(--health-bar-color);
        border-radius: 4px;
        transition: width 0.5s ease-out;
      }
      .other-residents-item {
        margin-bottom: 12px;
      }
      .choices-title {
        text-align: left;
        font-weight: bold;
        font-size: 1.1em;
        margin-bottom: 16px;
        color: var(--text-strong);
      }
      .choice-item {
        margin-bottom: 10px;
        padding: 12px 16px;
        background-color: var(--bg-medium);
        border-radius: 8px;
        border-left: 4px solid var(--border-color);
        cursor: pointer;
        transition: var(--transition-speed);
      }
      .choice-item:last-child {
        margin-bottom: 0;
      }
      .choice-item:hover {
        background-color: var(--bg-dark);
        transform: translateX(5px);
        border-left-color: var(--border-shadow-color);
      }
      .palette-button {
        position: absolute;
        right: 15px;
        top: 15px;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        border: 1px solid var(--border-color);
        background-color: var(--bg-medium);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2em;
        transition: var(--transition-speed);
        z-index: 20;
      }
      .palette-button:hover {
        transform: scale(1.1) rotate(45deg);
        box-shadow: 0 0 10px var(--border-shadow-color);
      }
      .palette-modal {
        display: none;
        position: absolute;
        bottom: calc(100% + 10px);
        right: 0;
        background-color: var(--bg-dark);
        border: 1px solid var(--border-color);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
        border-radius: var(--border-radius);
        padding: 20px;
        z-index: 1000;
        width: 300px;
        max-width: 90vw;
        max-height: 80vh;
        overflow-y: auto;
        animation: fadeInFromBottomRight 0.3s ease-out;
      }
      @keyframes fadeInFromBottomRight {
        from {
          opacity: 0;
          transform: scale(0.95) translateY(10px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }
      .palette-modal.show {
        display: block;
      }
      .palette-modal h3 {
        text-align: center;
        margin-top: 0;
        margin-bottom: 20px;
        color: var(--text-strong);
      }
      .palette-option {
        margin-bottom: 15px;
      }
      .palette-option label {
        display: block;
        margin-bottom: 5px;
        font-size: 0.9em;
      }
      .palette-option select {
        width: 100%;
        padding: 8px;
        border-radius: 6px;
        border: 1px solid var(--border-color);
        background-color: var(--bg-light);
        color: var(--text-color);
        font-family: inherit;
      }
      .palette-buttons {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }
      .palette-buttons button {
        flex: 1;
        padding: 10px;
        border-radius: 6px;
        border: 1px solid var(--border-color);
        background-color: var(--bg-medium);
        color: var(--text-color);
        cursor: pointer;
        transition: var(--transition-speed);
      }
      .palette-buttons button:hover {
        background-color: var(--border-color);
        color: var(--bg-dark);
      }
      .ability-list::-webkit-scrollbar {
        width: 8px;
      }
      .ability-list::-webkit-scrollbar-track {
        background: var(--bg-dark);
        border-radius: 4px;
      }
      .ability-list::-webkit-scrollbar-thumb {
        background-color: var(--border-color);
        border-radius: 4px;
        border: 2px solid var(--bg-dark);
      }
      .ability-list::-webkit-scrollbar-thumb:hover {
        background-color: var(--border-shadow-color);
      }
      @media (max-width: 600px) {
        .details-grid {
          grid-template-columns: 1fr;
        }
        main {
          padding: 12px;
          margin: 5px auto;
          font-size: var(--font-size-main, 14px);
        }
        .tab-button {
          padding: 6px 10px;
          font-size: 0.85em;
        }
      }
    </style>
  </head>
  <body>
    <main id="eden-main-container">
      <section class="section">
        <h2 class="section-title">ğŸŒ åŸºç¡€ä¿¡æ¯ ğŸŒ</h2>
        <div class="global-info-bar">
          <div class="info-item" id="game-location">ğŸ—ºï¸ (åŠ è½½åœ°ç‚¹ä¸­...)</div>
          <div class="info-item" id="game-date">ğŸ“… (åŠ è½½æ—¥æœŸä¸­...)</div>
          <div class="info-item" id="game-time">â³ (åŠ è½½æ—¶é—´ä¸­...)</div>
        </div>
      </section>
      <section class="section">
        <h2 class="section-title">ğŸ“– æ­£æ–‡å‰§æƒ… ğŸ“–</h2>
        <div class="content-text" id="main-content-text">(åŠ è½½æ­£æ–‡ä¸­...)</div>
      </section>
      <section class="section" id="shelter-section">
        <h2 class="section-title">ğŸ° åº‡æŠ¤æ‰€ä¿¡æ¯ ğŸ°</h2>
        <div class="shelter-grid">
          <div class="shelter-item">
            <div class="label">âšœï¸ åº‡æŠ¤æ‰€ç­‰çº§</div>
            <div class="value" id="shelter-level">--</div>
          </div>
          <div class="shelter-item">
            <div class="label">ğŸ² ä»Šæ—¥æŠ•æ·ç‚¹æ•°</div>
            <div class="value" id="shelter-dice">--</div>
          </div>
          <div class="shelter-item">
            <div class="label">â³ è·ç¦»ä¸‹æ¬¡ä¿åº•å‡çº§</div>
            <div class="value" id="shelter-cooldown">--</div>
          </div>
          <div class="shelter-item">
            <div class="label">ğŸ’¡ åº‡æŠ¤æ‰€èƒ½åŠ›åˆ—è¡¨</div>
            <div class="ability-list" id="shelter-abilities">(æš‚æ— èƒ½åŠ›)</div>
          </div>
        </div>
      </section>
      <section class="section" id="characters-section">
        <h2 class="section-title">ğŸ‘¤ ç™»åœºè§’è‰² ğŸ‘¤</h2>
        <div class="status-tabs-container">
          <div class="tab-buttons" id="tab-buttons-container"></div>
          <div id="tab-content-container"></div>
        </div>
      </section>
      <section class="section" id="other-residents-section">
        <h2 class="section-title">ğŸ¢ å…¶ä»–æ¥¼å±‚æƒ…å†µ ğŸ¢</h2>
        <div class="other-residents-item">
          <div class="label">ğŸ’¬ æ¥¼å±‚è¨€è¯­</div>
          <div class="value" id="other-residents-speech">--</div>
        </div>
        <div class="other-residents-item">
          <div class="label">ğŸƒ æ¥¼å±‚è¡Œä¸º</div>
          <div class="value" id="other-residents-actions">--</div>
        </div>
      </section>
      <section class="section">
        <button class="palette-button">ğŸ¨</button>
        <h2 class="section-title choices-title">âšœï¸ å¿«é€Ÿå‰§æƒ… âšœï¸</h2>
        <div id="choices-container"><div class="choice-item">(åŠ è½½é€‰é¡¹ä¸­...)</div></div>
        <div class="palette-modal">
          <h3>æ˜¾ç¤ºè®¾ç½®</h3>
          <div class="palette-option">
            <label>ğŸ¨ ä¸»é¢˜</label
            ><select id="theme-select">
              <option value="apocalypse_tech">æœ«æ—¥ç§‘æŠ€ (é»˜è®¤)</option>
              <option value="jade_green">æ·¡ç¿¡ç¿ ç»¿</option>
              <option value="parchment">å¤å¤ç¾Šçš®çº¸</option>
              <option value="milky">æ¸…æ–°å¥¶ç™½</option>
            </select>
          </div>
          <div class="palette-option">
            <label>ğŸ–‹ï¸ å­—ä½“</label
            ><select id="font-family-select">
              <option value="yahei">å¾®è½¯é›…é»‘ (é»˜è®¤)</option>
              <option value="simsun">å®‹ä½“</option>
              <option value="kaiti">æ¥·ä½“</option>
            </select>
          </div>
          <div class="palette-option">
            <label>â†”ï¸ å­—ä½“å¤§å°</label
            ><select id="font-size-select">
              <option value="12">12px (æœ€å°)</option>
              <option value="14">14px (è¾ƒå°)</option>
              <option value="15">15px (ç¨å°)</option>
              <option value="16">16px (é»˜è®¤)</option>
              <option value="18">18px (ç¨å¤§)</option>
              <option value="20">20px (è¾ƒå¤§)</option>
              <option value="22">22px (å¾ˆå¤§)</option>
              <option value="24">24px (æœ€å¤§)</option>
            </select>
          </div>
          <div class="palette-buttons"><button class="palette-close">å…³é—­</button></div>
        </div>
      </section>
    </main>
    <script id="injected-data-container" type="text/plain" style="display: none">
      $1
    </script>
    <script>
      (function () {
        var CORE_CHARACTERS = ['æµ…è§äºšç¾', 'ç›¸ç”°å“²ä¹Ÿ', 'æ˜Ÿé‡ç‰ç’ƒ', 'æ—©å·é¥', 'æ—©å·èˆ', 'è—¤äº•é›ªä¹ƒ', 'ä¸­æ‘æƒ å­'];
        const THEMES = {
          apocalypse_tech: {
            '--bg-main': '#1a1b26',
            '--bg-light': '#282a36',
            '--bg-medium': '#44475a',
            '--bg-dark': '#13141b',
            '--border-color': '#8be9fd',
            '--border-shadow-color': '#b3f2ff',
            '--text-color': '#f8f8f2',
            '--text-strong': '#ffffff',
            '--dialog-color': '#50fa7b',
            '--thought-color': '#ff79c6',
            '--accent-gold': '#f1fa8c',
            '--accent-red': '#ff5555',
            '--accent-blue': '#bd93f9',
            '--health-bar-color': '#50fa7b',
          },
          jade_green: {
            '--bg-main': '#f0f8f8',
            '--bg-light': '#ffffff',
            '--bg-medium': '#e0f0e0',
            '--bg-dark': '#d0e0d0',
            '--border-color': '#20B2AA',
            '--border-shadow-color': '#a7dbd8',
            '--text-color': '#333333',
            '--text-strong': '#000000',
            '--dialog-color': '#1E90FF',
            '--thought-color': '#6A5ACD',
            '--accent-gold': '#FFA500',
            '--accent-red': '#DC143C',
            '--accent-blue': '#4682B4',
            '--health-bar-color': '#28a745',
          },
          parchment: {
            '--bg-main': '#efe3c3',
            '--bg-light': '#e8d9b0',
            '--bg-medium': '#c3a56e',
            '--bg-dark': '#6c4a24',
            '--border-color': '#8a6642',
            '--border-shadow-color': '#5a3a28',
            '--text-color': '#3a2d1f',
            '--text-strong': '#000000',
            '--dialog-color': '#1e3a8a',
            '--thought-color': '#8B0000',
            '--accent-gold': '#c19a49',
            '--accent-red': '#8b3a3a',
            '--accent-blue': '#2c4875',
            '--health-bar-color': '#d2691e',
          },
          milky: {
            '--bg-main': '#f5f5f5',
            '--bg-medium': '#e8e8e8',
            '--bg-light': '#ffffff',
            '--bg-dark': '#dcdcdc',
            '--border-color': '#79a07b',
            '--border-shadow-color': '#c0c0c0',
            '--text-color': '#4a4a4a',
            '--text-strong': '#000000',
            '--dialog-color': '#4682B4',
            '--thought-color': '#6A5ACD',
            '--accent-gold': '#d2b48c',
            '--accent-red': '#cd5c5c',
            '--accent-blue': '#5f9ea0',
            '--health-bar-color': '#8fbc8f',
          },
        };
        const FONT_MAP = { yahei: '"Microsoft YaHei", sans-serif', simsun: 'SimSun, serif', kaiti: 'KaiTi, serif' };
        const hardcodedInitialData = {
          ä¸–ç•Œ: {
            åœ°å€: ['ä¸œå’Œå›½ | ç‘å³°å¸‚ | ä¸­å¤®åŒº | æ˜Ÿç©¹å›½é™…å…¬å¯“ | 20å±‚2001å®¤'],
            æ—¥æœŸ: ['æœ«æ—¥çºªå…ƒï¼Œ9527å¹´12æœˆ10æ—¥'],
            æ—¶é—´: ['æ—©æ™¨ - 08:30'],
            æœ«æ—¥å¤©æ•°: [3],
          },
          åº‡æŠ¤æ‰€: {
            åº‡æŠ¤æ‰€ç­‰çº§: [1],
            ä»Šæ—¥æŠ•æ·ç‚¹æ•°: ['ä»Šæ—¥å·²æŠ•æ·: 73ç‚¹ (æœªå‡çº§)'],
            è·ç¦»ä¸Šæ¬¡å‡çº§: ['0å¤© | å‰©ä½™ä¿åº•å‡çº§å¤©æ•°ï¼š7å¤©'],
            åº‡æŠ¤æ‰€èƒ½åŠ›: [
              [
                '$__META_EXTENSIBLE__$',
                {
                  name: 'ğŸ›¡ï¸ç»å¯¹å®‰å…¨å±éšœğŸ›¡ï¸',
                  desc: 'åº‡æŠ¤æ‰€çš„å¤–å¢™ã€é—¨çª—å‡ç”±æœªçŸ¥è¶…åˆé‡‘æ„æˆï¼Œå½¢æˆä¸€ä½“åŒ–çš„ç»å¯¹ç‰©ç†å±éšœã€‚ä¸»å…¥å£çš„æ°”å¯†èˆ±é—¨è¶³ä»¥æŠµå¾¡åŒ…æ‹¬ç©¿ç”²ç«ç®­å¼¹åœ¨å†…çš„å¸¸è§„æ”»åŸæ­¦å™¨ï¼Œç¡®ä¿å¤–éƒ¨çš„ä»»ä½•ç¾å®³ä¸æš´åŠ›éƒ½æ— æ³•ä¾µæ‰°æ‚¨çš„å®‰å®ã€‚',
                },
                {
                  name: 'âš¡â€œä»²è£è€…â€å†…éƒ¨å®‰é˜²ç³»ç»Ÿâš¡',
                  desc: 'åº‡æŠ¤æ‰€çš„åœ°æ¿ã€å¢™å£å†…é›†æˆäº†çº³ç±³çº§å®‰é˜²ç½‘ç»œã€‚ä¸€æ—¦â€œä¼Šç”¸â€AIé€šè¿‡ç”Ÿç‰©ç‰¹å¾æˆ–æ‚¨çš„æŒ‡ä»¤ï¼Œåˆ¤å®šè¿›å…¥å†…éƒ¨çš„è®¿å®¢æ€€æœ‰æ•Œæ„æˆ–æ”»å‡»å€¾å‘ï¼Œç³»ç»Ÿä¼šç¬é—´é‡Šæ”¾é«˜å‹ç”µæµï¼Œä½¿å…¶ç«‹åˆ»éº»ç—¹å¹¶ä¸§å¤±è¡ŒåŠ¨èƒ½åŠ›ï¼Œä»»æ‚¨å¤„ç½®ã€‚ä»è¿™ä¸€åˆ»èµ·ï¼Œä»»ä½•è¿›å…¥æ‚¨å®¶çš„äººï¼Œç”Ÿæ­»çš†åœ¨æ‚¨ä¸€å¿µä¹‹é—´ã€‚',
                },
                {
                  name: 'ğŸ’§æ— é™åŸºç¡€èµ„æºğŸ’§',
                  desc: 'å†…éƒ¨ç®¡ç½‘ç³»ç»Ÿä¸ä¸€ä¸ªå¾®å‹ç‰©è´¨é‡ç»„å•å…ƒç›¸è¿ï¼Œå¯æ— é™é‡ä¾›åº”ç”Ÿå‘½æ‰€éœ€çš„åŸºç¡€èµ„æºã€‚åŒ…æ‹¬ä½†ä¸é™äºï¼šçº¯å‡€é¥®ç”¨æ°´ã€ç”Ÿæ´»çƒ­æ°´ã€ç¨³å®šç”µåŠ›ä»¥åŠåŸºç¡€é€Ÿé£Ÿï¼ˆå¦‚é¢åŒ…ã€ç‰›å¥¶ã€æ–¹ä¾¿é¢ã€å‹ç¼©é¥¼å¹²ã€è‡ªçƒ­ç±³é¥­ç­‰ï¼‰ã€‚',
                },
                {
                  name: 'ğŸŒ¡ï¸ç¯å¢ƒå¾ªç¯ç³»ç»ŸğŸŒ¡ï¸',
                  desc: 'ä¸€å¥—å®Œå…¨ç‹¬ç«‹çš„ç©ºæ°”å‡€åŒ–ä¸æ¸©æ§ç³»ç»Ÿã€‚å®ƒèƒ½24å°æ—¶ä¸é—´æ–­åœ°è¿‡æ»¤å¹¶å¾ªç¯å®¤å†…ç©ºæ°”ï¼Œç»´æŒåŒ»ç”¨æ— èŒæ ‡å‡†ï¼ŒåŒæ—¶å°†å®¤æ¸©æ’å®šåœ¨æ‚¨è®¾å®šçš„æœ€èˆ’é€‚çš„æ¸©åº¦ï¼Œè®©æ‚¨å½»åº•éš”ç»å¤–ç•Œçš„ä¸¥å¯’ã€‚',
                },
                {
                  name: 'ğŸ“¡å¯¹å¤–è§‚å¯Ÿæ¥å£ğŸ“¡',
                  desc: 'ä½äºç„å…³çš„é›†æˆç³»ç»Ÿï¼ŒåŒ…å«ä¸€å—é«˜æ¸…æ˜¾ç¤ºå±å’Œä¸€å¥—åŒå‘é€šä¿¡è®¾å¤‡ã€‚æ‚¨å¯ä»¥å®‰å…¨åœ°åœ¨å®¤å†…ä¸é—¨å¤–çš„è®¿å®¢å¯¹è¯ï¼Œå¹¶é€šè¿‡éå¸ƒå…¬å¯“æ¥¼å†…å¤–çš„å¾®å‹æ— äººæœºï¼ˆæ­¤æ—¶ä»…æœ‰ç›‘è§†åŠŸèƒ½ï¼‰è§‚å¯Ÿå‘¨è¾¹æƒ…å†µã€‚',
                },
                {
                  name: 'ğŸ“¤å•å‘ç‰©èµ„æŠ•é€ä»“ğŸ“¤',
                  desc: 'ä½äºç„å…³å¢™å£ä¸Šçš„ä¸€ä¸ªå°å‹æŠ•é€è£…ç½®ã€‚æ‚¨å¯ä»¥ä»åº‡æŠ¤æ‰€å†…éƒ¨ï¼Œå°†ç‰©èµ„ï¼ˆé£Ÿç‰©ã€æ°´ã€è¯å“ç­‰ï¼‰å•å‘æŠ•é€è‡³ç„å…³æˆ–ç›´æ¥æŠ•é€åˆ°å¤–é¢çš„èµ°å»Šï¼Œç”¨äºäº¤æ˜“æˆ–æ–½èˆï¼Œå…¨ç¨‹æ— éœ€å¼€é—¨ã€‚',
                },
              ],
            ],
          },
          æµ…è§äºšç¾: {
            å§“å: ['æµ…è§äºšç¾'],
            å¹´é¾„: [24],
            å¥åº·: [90],
            å¥åº·æ›´æ–°åŸå› : ['åˆå§‹çŠ¶æ€'],
            å¥åº·çŠ¶å†µ: ['äºšå¥åº·'],
            è¡£ç€: [
              'èº«ä¸Šç©¿ç€ä¸€ä»¶åšå®çš„ç±³ç™½è‰²é•¿æ¬¾ç¾½ç»’æœï¼Œé‡Œé¢æ˜¯å±…å®¶é£æ ¼çš„æ·¡ç²‰è‰²é’ˆç»‡æ¯›è¡£å’Œç°è‰²é•¿è£¤ï¼Œè„šä¸Šæ˜¯æ™®é€šçš„é›ªåœ°é´ã€‚',
            ],
            èˆŒå”‡: ['å˜´å”‡å› å¯’å†·å’Œç´§å¼ è€Œæœ‰äº›å‘ç™½ã€å¹²æ¶©ï¼ŒèˆŒå¤´æŸ”è½¯ï¼Œå£è…”å†…æ°”æ¯æ¸©çƒ­ä½†ç•¥å¸¦ä¸€ä¸å› é¥¥é¥¿äº§ç”Ÿçš„å‘³é“ã€‚'],
            èƒ¸ä¹³: ['åœ¨åšé‡çš„è¡£ç‰©ä¸‹ï¼Œé¥±æ»¡æŸ”è½¯çš„Dç½©æ¯èƒ¸éƒ¨è¢«ä¿å®ˆçš„æ£‰è´¨èƒ¸è¡£åŒ…è£¹ç€ï¼Œä¹³å¤´å› å¯’å†·åˆºæ¿€è€Œå¾®å¾®å‘ç¡¬ã€‚'],
            ç§ç©´: [
              'åœ¨ä¿æš–è£¤ä¹‹ä¸‹æ˜¯å¹²å‡€çš„çº¯æ£‰å†…è£¤ï¼Œç§å¤„ä¿æŒç€å¹²çˆ½å’Œçº¯æ´ï¼Œä½œä¸ºå¤„å¥³ï¼Œå°ç©´ç´§è‡´è€Œæœªç»æ¢ç´¢ï¼ŒèŠç©´åŒæ ·å¹²å‡€ç´§é—­ã€‚',
            ],
            ç¥æ€æ ·è²Œ: [
              'è„¸é¢Šå› å¯’å†·è€Œæ³›ç€é’ç™½è‰²ï¼Œæ¼‚äº®çš„æçœ¼ä¸­å……æ»¡äº†å¯¹æœªçŸ¥çš„ç´§å¼ ã€ä¸å®‰å’Œä¸€ä¸å¯¹ç°çŠ¶çš„è¿·èŒ«ï¼Œç´§ç´§é ç€ä¸ˆå¤«ï¼Œæ˜¾å¾—æ¥šæ¥šå¯æ€œã€‚',
            ],
            åŠ¨ä½œå§¿åŠ¿: [
              'èº«ä½“å¾®å¾®å‘æŠ–åœ°ç«™åœ¨ä¸ˆå¤«ç›¸ç”°å“²ä¹Ÿèº«ä¾§é ååŠæ­¥çš„ä½ç½®ï¼ŒåŒæ‰‹ç´§å¼ åœ°æ”¥ç€è‡ªå·±çš„è¡£è§’ï¼Œå§¿æ€æ˜¾å¾—æœ‰äº›è¢«åŠ¨å’Œä¾èµ–ã€‚',
            ],
            å†…å¿ƒæƒ³æ³•: [
              'å¥½å†·â€¦â€¦å¹¿æ’­é‡Œè¯´çš„æ˜¯çœŸçš„å—ï¼Ÿæ”¿åºœçœŸçš„æ²¡äº†ï¼Ÿå“²ä¹Ÿå›çœ‹èµ·æ¥å¥½å†·é™ï¼Œä½†ä»–å¥½åƒä¹Ÿå¾ˆç´§å¼ â€¦â€¦æˆ‘ä»¬è¯¥æ€ä¹ˆåŠï¼Ÿé‚»å±…çš„å®¶â€¦â€¦é—¨å¥½å¥‡æ€ªï¼Œä»–ä¼šå¸®æˆ‘ä»¬å—ï¼Ÿ',
            ],
            ç™»åœºçŠ¶æ€: ['ç™»åœº'],
          },
          ç›¸ç”°å“²ä¹Ÿ: { ç™»åœºçŠ¶æ€: ['ç™»åœº'] },
          æ˜Ÿé‡ç‰ç’ƒ: { ç™»åœºçŠ¶æ€: ['ç™»åœº'] },
          æ—©å·é¥: { ç™»åœºçŠ¶æ€: ['ç™»åœº'] },
          æ—©å·èˆ: { ç™»åœºçŠ¶æ€: ['ç™»åœº'] },
          è—¤äº•é›ªä¹ƒ: { ç™»åœºçŠ¶æ€: ['ç™»åœº'] },
          ä¸­æ‘æƒ å­: { ç™»åœºçŠ¶æ€: ['ç™»åœº'] },
          ä¸´æ—¶NPC: { ç™»åœºçŠ¶æ€: ['ç¦»åœº'] },
          æ¥¼å±‚å…¶ä»–ä½æˆ·: { è¨€è¯­: ['...'], è¡Œä¸º: ['...'] },
        };

        function initializeUI() {
          setupPalette();
          fetchDataWithRetry();
        }

        function generateCharacterTabs() {
          const btns_cont = document.getElementById('tab-buttons-container');
          const tabs_cont = document.getElementById('tab-content-container');
          if (!btns_cont || !tabs_cont) return;
          btns_cont.innerHTML = '';
          tabs_cont.innerHTML = '';

          const allChars = [...CORE_CHARACTERS, 'ä¸´æ—¶NPC'];
          allChars.forEach(charName => {
            const btn = document.createElement('button');
            btn.className = 'tab-button';
            btn.textContent = charName;
            btn.dataset.charName = charName;
            btn.style.display = 'none';
            btn.onclick = () => showTab(charName);
            btns_cont.appendChild(btn);

            const tab = document.createElement('div');
            tab.id = `${charName}-tab-content`;
            tab.className = 'tab-content';
            tab.innerHTML = `
                    <div class="status-grid">
                        <div class="status-item health-section">
                            <div class="health-section-header">
                                <div class="label">â¤ï¸ å¥åº·</div>
                                <div class="value" id="${charName}-å¥åº·">--</div>
                            </div>
                            <div class="health-status-subtext" id="${charName}-å¥åº·çŠ¶å†µ">--</div>
                            <div class="progress-bar-container"><div class="progress-bar-value" id="${charName}-å¥åº·-bar"></div></div>
                            <div class="value-subtext" id="${charName}-å¥åº·æ›´æ–°åŸå› ">--</div>
                        </div>
                        <div class="details-grid">
                            <div class="status-item"><div class="label">ğŸ‘š è¡£ç€</div><div class="value" id="${charName}-è¡£ç€">--</div></div>
                            <div class="status-item"><div class="label">ğŸ‘… èˆŒå”‡</div><div class="value" id="${charName}-èˆŒå”‡">--</div></div>
                            <div class="status-item"><div class="label">ğŸˆ èƒ¸ä¹³</div><div class="value" id="${charName}-èƒ¸ä¹³">--</div></div>
                            <div class="status-item"><div class="label">ğŸŒ¸ ç§ç©´</div><div class="value" id="${charName}-ç§ç©´">--</div></div>
                            <div class="status-item"><div class="label">ğŸ˜Š ç¥æ€æ ·è²Œ</div><div class="value" id="${charName}-ç¥æ€æ ·è²Œ">--</div></div>
                            <div class="status-item"><div class="label">ğŸ’ƒ åŠ¨ä½œå§¿åŠ¿</div><div class="value" id="${charName}-åŠ¨ä½œå§¿åŠ¿">--</div></div>
                        </div>
                        <div class="status-item">
                            <div class="label">ğŸ’­ å†…å¿ƒæƒ³æ³•</div><div class="value thought-text" id="${charName}-å†…å¿ƒæƒ³æ³•">--</div>
                        </div>
                    </div>`;
            tabs_cont.appendChild(tab);
          });
        }

        let retryCount = 0;
        const MAX_RETRIES = 5;
        async function fetchDataWithRetry() {
          const msgId = getCurrentMessageId();
          const msgs = await getChatMessages(msgId);

          if (msgs[0].data.stat_data) {
            const keys = Object.keys(msgs[0].data.stat_data);
            keys.forEach(e => {
              if (
                e !== 'ä¸–ç•Œ' &&
                e !== 'åº‡æŠ¤æ‰€' &&
                e !== 'ä¸´æ—¶NPC' &&
                e !== 'æ¥¼å±‚å…¶ä»–ç”¨æˆ·' &&
                CORE_CHARACTERS.indexOf(e) === -1
              ) {
                CORE_CHARACTERS.push(e);
              }
            });
          }
          generateCharacterTabs();
          try {
            if (typeof getCurrentMessageId !== 'function' || typeof getChatMessages !== 'function') {
              return updateDisplays(hardcodedInitialData);
            }

            if (msgs && msgs.length > 0 && msgs[0].data && msgs[0].data.stat_data) {
              updateDisplays(msgs[0].data.stat_data);
              retryCount = 0;
            } else {
              if (retryCount < MAX_RETRIES) {
                retryCount++;
                setTimeout(fetchDataWithRetry, 300);
              } else {
                updateDisplays(hardcodedInitialData);
              }
            }
          } catch (error) {
            updateDisplays(hardcodedInitialData);
          } finally {
            updateFromInjectedText();
            setTimeout(() => window.dispatchEvent(new Event('resize')), 150);
          }
        }

        function updateDisplays(data) {
          if (!data) {
            data = hardcodedInitialData;
          }
          const world = data.ä¸–ç•Œ || {};
          const shelter = data.åº‡æŠ¤æ‰€ || {};
          const otherResidents = data.æ¥¼å±‚å…¶ä»–ä½æˆ· || {};

          updateElementText('game-location', `ğŸ—ºï¸ ${world.åœ°å€ ? world.åœ°å€[0] : 'æœªçŸ¥'}`);
          updateElementText('game-date', `ğŸ“… ${world.æ—¥æœŸ ? world.æ—¥æœŸ[0] : 'æœªçŸ¥'}`);
          updateElementText('game-time', `â³ ${world.æ—¶é—´ ? world.æ—¶é—´[0] : 'æœªçŸ¥'}`);

          updateElementText('shelter-level', shelter.åº‡æŠ¤æ‰€ç­‰çº§ ? shelter.åº‡æŠ¤æ‰€ç­‰çº§[0] : '--');
          updateElementText('shelter-dice', shelter.ä»Šæ—¥æŠ•æ·ç‚¹æ•° ? shelter.ä»Šæ—¥æŠ•æ·ç‚¹æ•°[0] : '--');
          updateElementText('shelter-cooldown', shelter.è·ç¦»ä¸Šæ¬¡å‡çº§ ? shelter.è·ç¦»ä¸Šæ¬¡å‡çº§[0] : '--');

          const abilitiesContainer = document.getElementById('shelter-abilities');
          if (abilitiesContainer) {
            const abilities =
              shelter.åº‡æŠ¤æ‰€èƒ½åŠ› && Array.isArray(shelter.åº‡æŠ¤æ‰€èƒ½åŠ›[0])
                ? shelter.åº‡æŠ¤æ‰€èƒ½åŠ›[0].filter(item => typeof item === 'object')
                : [];
            if (abilities.length > 0) {
              abilitiesContainer.innerHTML = abilities
                .map(
                  ab =>
                    `<div class="ability-card"><div class="name">${ab.name}</div><div class="desc">${ab.desc}</div></div>`,
                )
                .join('');
            } else {
              abilitiesContainer.innerHTML = '(æš‚æ— èƒ½åŠ›)';
            }
          }

          let firstActiveChar = null;
          let visibleTabsCount = 0;
          const allChars = [...CORE_CHARACTERS, 'ä¸´æ—¶NPC'];

          allChars.forEach(charName => {
            const charData = data[charName] || { ç™»åœºçŠ¶æ€: ['ç¦»åœº'] };
            const btn = document.querySelector(`.tab-button[data-char-name="${charName}"]`);
            if (!btn) return;

            const status = charData.ç™»åœºçŠ¶æ€ ? charData.ç™»åœºçŠ¶æ€[0] : 'ç¦»åœº';
            if (status === 'ç™»åœº') {
              btn.style.display = '';
              visibleTabsCount++;
              if (!firstActiveChar) firstActiveChar = charName;

              if (charName === 'ä¸´æ—¶NPC') {
                const npcName = charData.å§“å && charData.å§“å[0] !== 'æ— ' ? charData.å§“å[0] : 'ä¸´æ—¶NPC';
                btn.textContent = npcName;
              }
            } else {
              btn.style.display = 'none';
            }

            updateProgressBar(`${charName}-å¥åº·-bar`, charData.å¥åº· ? charData.å¥åº·[0] : 0, 0, 100);
            const healthValue = charData.å¥åº· ? parseInt(charData.å¥åº·[0], 10) : NaN;
            const displayedHealth = !isNaN(healthValue) ? Math.min(healthValue, 100) : '--';
            updateElementText(`${charName}-å¥åº·`, displayedHealth);
            updateElementText(`${charName}-å¥åº·çŠ¶å†µ`, charData.å¥åº·çŠ¶å†µ ? charData.å¥åº·çŠ¶å†µ[0] : '--');
            updateElementText(`${charName}-å¥åº·æ›´æ–°åŸå› `, charData.å¥åº·æ›´æ–°åŸå›  ? charData.å¥åº·æ›´æ–°åŸå› [0] : '--');
            updateElementText(`${charName}-è¡£ç€`, charData.è¡£ç€ ? charData.è¡£ç€[0] : '--');
            updateElementText(`${charName}-èˆŒå”‡`, charData.èˆŒå”‡ ? charData.èˆŒå”‡[0] : '--');
            updateElementText(`${charName}-èƒ¸ä¹³`, charData.èƒ¸ä¹³ ? charData.èƒ¸ä¹³[0] : '--');
            updateElementText(`${charName}-ç§ç©´`, charData.ç§ç©´ ? charData.ç§ç©´[0] : '--');
            updateElementText(`${charName}-ç¥æ€æ ·è²Œ`, charData.ç¥æ€æ ·è²Œ ? charData.ç¥æ€æ ·è²Œ[0] : '--');
            updateElementText(`${charName}-åŠ¨ä½œå§¿åŠ¿`, charData.åŠ¨ä½œå§¿åŠ¿ ? charData.åŠ¨ä½œå§¿åŠ¿[0] : '--');
            updateElementText(`${charName}-å†…å¿ƒæƒ³æ³•`, charData.å†…å¿ƒæƒ³æ³• ? charData.å†…å¿ƒæƒ³æ³•[0] : '--');
          });
          const charactersSection = document.getElementById('characters-section');
          if (charactersSection) charactersSection.style.display = visibleTabsCount > 0 ? '' : 'none';
          if (firstActiveChar) showTab(firstActiveChar);

          updateElementText('other-residents-speech', otherResidents.è¨€è¯­ ? otherResidents.è¨€è¯­[0] : '--');
          updateElementText('other-residents-actions', otherResidents.è¡Œä¸º ? otherResidents.è¡Œä¸º[0] : '--');
        }

        function updateFromInjectedText() {
          const cont = document.getElementById('injected-data-container');
          if (!cont) return;
          const raw = cont.textContent || '';
          const mainMatch = raw.match(/<content>(.*?)(?:<\/content>|<option>)/s);
          const optMatch = raw.match(/<option>(.*?)<\/option>/s);
          const mainEl = document.getElementById('main-content-text');
          if (mainMatch && mainEl) {
            mainEl.innerHTML = mainMatch[1].trim();
            formatSpecialText(mainEl);
          }
          const choicesEl = document.getElementById('choices-container');
          if (optMatch && choicesEl) {
            const lines = optMatch[1]
              .trim()
              .split('\n')
              .filter(l => l.trim() !== '');
            choicesEl.innerHTML = '';
            lines.forEach(l => {
              const text = l.trim();
              if (!text) return;
              const div = document.createElement('div');
              div.className = 'choice-item';
              div.innerHTML = text;
              div.onclick = () => handleChoiceClick(text);
              choicesEl.appendChild(div);
            });
          } else if (choicesEl) {
            choicesEl.innerHTML = `<div class="choice-item">å½“å‰æ— é€‰é¡¹ï¼Œè¯·è‡ªç”±è¡ŒåŠ¨...</div>`;
          }
        }

        function handleChoiceClick(text) {
          if (typeof triggerSlash === 'function') {
            try {
              triggerSlash(`/send ${text} | /trigger await=true`);
            } catch (e) {
              alert(`æŒ‡ä»¤å‘é€å¤±è´¥: ${text}`);
            }
          } else {
            alert(`æ— æ³•è‡ªåŠ¨å‘é€: ${text}`);
          }
        }
        function updateElementText(id, text) {
          const el = document.getElementById(id);
          if (el) el.innerHTML = text;
        }
        function updateProgressBar(id, val, min, max) {
          const bar = document.getElementById(id);
          if (!bar) return;
          const num =
            typeof val === 'string' && !isNaN(parseInt(val)) ? parseInt(val) : typeof val === 'number' ? val : 0;
          const pct = Math.max(0, Math.min(100, ((num - min) / (max - min)) * 100));
          bar.style.width = `${pct}%`;
        }
        function showTab(name) {
          document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
          document.querySelectorAll('.tab-button').forEach(tb => tb.classList.remove('active'));
          const content = document.getElementById(`${name}-tab-content`),
            btn = document.querySelector(`.tab-button[data-char-name="${name}"]`);
          if (content) content.classList.add('active');
          if (btn) btn.classList.add('active');
        }
        function formatSpecialText(el) {
          el.innerHTML = el.innerHTML.replace(/â€œ([^â€]+)â€|"([^"]+)"|\*([^*]+)\*/g, (m, cq, eq, t) => {
            if (t) return `<span class="thought-text">*${t}*</span>`;
            if (cq) return `<span class="dialog-text">â€œ${cq}â€</span>`;
            if (eq) return `<span class="dialog-text">"${eq}"</span>`;
            return m;
          });
        }
        function setupPalette() {
          const mainContainer = document.getElementById('eden-main-container');
          const btn = document.querySelector('.palette-button'),
            modal = document.querySelector('.palette-modal'),
            close = document.querySelector('.palette-close');
          const themeSel = document.getElementById('theme-select'),
            fontSel = document.getElementById('font-family-select'),
            sizeSel = document.getElementById('font-size-select');

          const applyTheme = name => {
            document.documentElement.dataset.theme = name;
            localStorage.setItem('eden_theme', name);
          };
          const applyFontFamily = key => {
            mainContainer.style.fontFamily = FONT_MAP[key] || FONT_MAP['yahei'];
            localStorage.setItem('eden_font_key', key);
          };
          const applyFontSize = key => {
            mainContainer.style.setProperty('--font-size-main', `${key}px`);
            localStorage.setItem('eden_font_size_key', key);
          };

          btn.onclick = e => {
            e.stopPropagation();
            modal.classList.toggle('show');
          };
          close.onclick = () => modal.classList.remove('show');
          document.addEventListener('click', e => {
            if (!modal.contains(e.target) && !btn.contains(e.target)) modal.classList.remove('show');
          });

          themeSel.onchange = e => applyTheme(e.target.value);
          fontSel.onchange = e => applyFontFamily(e.target.value);
          sizeSel.onchange = e => applyFontSize(e.target.value);

          const savedTheme = localStorage.getItem('eden_theme') || 'apocalypse_tech';
          const savedFontKey = localStorage.getItem('eden_font_key') || 'yahei';
          const savedSizeKey = localStorage.getItem('eden_font_size_key') || '16';

          themeSel.value = savedTheme;
          fontSel.value = savedFontKey;
          sizeSel.value = savedSizeKey;
          applyTheme(savedTheme);
          applyFontFamily(savedFontKey);
          applyFontSize(savedSizeKey);
        }
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
          initializeUI();
        } else {
          document.addEventListener('DOMContentLoaded', initializeUI);
        }
      })();
    </script>
  </body>
</html>
```
